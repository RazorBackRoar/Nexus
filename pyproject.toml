# ============================================================================
# RAZORCORE - SHARED FOUNDATION LIBRARY
# ============================================================================
# This pyproject.toml follows RazorBackRoar workspace standards
# Last Updated: 2026-01-28
# Python Version: 3.13.x (STRICT LOCK - never upgrade to 3.14+)
# ============================================================================

[build-system]
requires = ["setuptools>=70", "wheel"]
build-backend = "setuptools.build_meta"

[tool.setuptools.packages.find]
where = ["src"]
include = ["nexus*"]

[project]
name = "nexus"
version = "3.10.2"
description = "Nexus desktop bookmark and URL manager"
requires-python = "==3.13.*"
# WHY: Python 3.13.x is locked per IDE_CONTEXT.md requirements

dependencies = [
    "PySide6>=6.6.0",
    "Pillow>=10.0.0",
]

# ============================================================================
# RUFF CONFIGURATION - STANDARDIZED ACROSS ALL RAZORBACKROAR PROJECTS
# ============================================================================
# This exact configuration should be mirrored in:
# - /Users/home/Workspace/Apps/.razorcore/pyproject.toml
# - /Users/home/Workspace/Apps/4Charm/pyproject.toml
# - /Users/home/Workspace/Apps/Nexus/pyproject.toml
# - /Users/home/Workspace/Apps/Papyrus/pyproject.toml
# ============================================================================

[tool.ruff]
# Line length matches PEP 8 and Black defaults
line-length = 88

# Target Python 3.13 specifically
target-version = "py313"

# Source code locations (adjust per project)
src = ["src"]

# Exclude common directories that should never be linted
exclude = [
    ".git",
    ".venv",
    "venv",
    "__pycache__",
    "*.pyc",
    ".pytest_cache",
    ".ruff_cache",
    ".agent",
    ".shared",
    "build",
    "dist",
    "*.egg-info",
    ".DS_Store",
]

# ============================================================================
# RULE SELECTION
# ============================================================================
# Starting with essential rules, expand gradually as team agrees
# WHY: Too many rules at once = developer frustration and ignored warnings

[tool.ruff.lint]
select = [
    # ESSENTIAL RULES - Always enforce these
    "E",      # pycodestyle errors (PEP 8 violations)
    "F",      # pyflakes (undefined names, unused imports, etc.)
    "I",      # isort (import sorting)

    # CODE QUALITY - Catch common bugs
    "B",      # flake8-bugbear (likely bugs and design problems)
    "C4",     # flake8-comprehensions (better list/dict/set comprehensions)
    "UP",     # pyupgrade (modernize Python code for your version)

    # STYLE - Keep code readable
    "N",      # pep8-naming (function/variable naming conventions)
    "W",      # pycodestyle warnings

    # DOCUMENTATION - Enforce good practices
    "D",      # pydocstyle (docstring conventions)
]

# Rules to ignore (with explanations)
ignore = [
    "D100",   # Missing docstring in public module
    "D101",   # Missing docstring in public class
    "D102",   # Missing docstring in public method
    "D103",   # Missing docstring in public function
    "D104",   # Missing docstring in public package
    "D107",   # Missing docstring in __init__
    # WHY: Docstrings are good but enforcing them everywhere is overwhelming
    # TODO: Remove these ignores gradually as documentation improves

    "E501",   # Line too long
    # WHY: Ruff's formatter handles this automatically
]

# ============================================================================
# SPECIFIC RULE CONFIGURATIONS
# ============================================================================

[tool.ruff.lint.per-file-ignores]
# Test files don't need docstrings and can use assert statements
"tests/**/*.py" = ["D", "S101"]

# __init__.py files often just import for convenience
"__init__.py" = ["F401"]

[tool.ruff.lint.pydocstyle]
# Use Google-style docstrings (most popular in Python community)
convention = "google"
# WHY: Google style is clean and widely recognized
# Example:
# def function(param1: str, param2: int) -> bool:
#     """Brief description.
#
#     Longer description if needed.
#
#     Args:
#         param1: Description of param1.
#         param2: Description of param2.
#
#     Returns:
#         Description of return value.
#     """

[tool.ruff.lint.isort]
# Organize imports consistently
known-first-party = ["nexus"]
# WHY: This tells isort that razorcore is your code, not a third-party library

# Separate import groups with a blank line
lines-after-imports = 2
# WHY: Makes import section clearly separated from code

[tool.ruff.format]
# Use double quotes for strings (Python community standard)
quote-style = "double"

# Use spaces for indentation (never tabs)
indent-style = "space"

# Keep line endings Unix-style (LF not CRLF)
line-ending = "lf"
# WHY: macOS uses Unix-style line endings

# ============================================================================
# MIGRATION NOTES
# ============================================================================
# HISTORY: Migrated from Pylint to Ruff (2025)
# REASON: Ruff is 10-100x faster, combines multiple tools (Pylint, Black,
#         isort, Flake8, pyupgrade), and has better IDE integration
#
# REPLACED TOOLS:
# - Pylint → Ruff (linting)
# - Black → Ruff (formatting)
# - isort → Ruff (import sorting)
# - Flake8 → Ruff (style checking)
# - pyupgrade → Ruff (syntax modernization)
# ============================================================================

[tool.pytest.ini_options]
pythonpath = ["src"]
testpaths = ["tests"]

[tool.coverage.run]
branch = true
source = ["nexus"]

[tool.coverage.report]
show_missing = true
skip_covered = true

[tool.ty.src]
exclude = [
    ".agent/**",
    ".shared/**",
]

[tool.ty.analysis]
allowed-unresolved-imports = ["razorcore.threading"]

[tool.ty.environment]
extra-paths = [
    "src",
    "/Users/home/Library/Python/3.13/lib/python/site-packages",
    "/opt/homebrew/lib/python3.13/site-packages",
]
